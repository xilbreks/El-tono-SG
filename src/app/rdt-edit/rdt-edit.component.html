<h4>RDT {{ idrdt }}</h4>

<div>
  <button class="btn btn-outline-success" (click)="openNewTaskModal(newTaskModal)">
    + Agregar tarea
  </button>
</div>

<div style="display: flex; overflow-x: scroll;">
  <table class="table table-striped" id="tareas_rdt">
    <thead>
      <tr>
        <th scope="col">#</th>
        <th scope="col" class="vertical">Cliente</th>
        <th scope="col" class="vertical">Atención</th>
        <th scope="col" class="vertical">Delegado por</th>
        <th scope="col" class="vertical">Expediente</th>
        <th scope="col" class="vertical">Tipo de proceso</th>
        <th scope="col" class="vertical">Cliente</th>
        <th scope="col" class="vertical">Demandado</th>
        <th scope="col" class="vertical">ITER</th>
        <th scope="col" class="vertical">Avance(%)</th>
        <th scope="col" class="vertical">F. culminación</th>
        <th scope="col" class="vertical">T. Atención</th>
        <th scope="col" class="vertical">Código de tarea</th>
        <th scope="col" class="vertical">Mención de la tarea</th>
        <th scope="col" class="vertical">Acciones a realizar</th>
        <th></th>
        <th></th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let tarea of lstTareas; let i = index">
        <th scope="row">{{ i + 1 }}</th>
        <td class="vertical">
          {{ tarea.ntipocliente }}
        </td>
        <td class="vertical">
          {{ tarea.ntipoatencion }}
        </td>
        <td class="vertical">
          {{ tarea.sdelegadopor }}
        </td>
        <td class="vertical">
          {{ tarea.sexpediente }}
        </td>
        <td class="vertical">
          {{ tarea.ntipoproceso }}
        </td>
        <td class="vertical">
          {{ tarea.scliente }}
        </td>
        <td class="vertical">
          {{ tarea.sdemandado }}
        </td>
        <td>
          {{ tarea.niter }}
        </td>
        <td>
          {{ tarea.navance }}
        </td>
        <td class="vertical">
          {{ tarea.fculminacion }}
        </td>
        <td>
          {{tarea.nhorasatencion}}:{{tarea.nminutosatencion}}
        </td>
        <td>
          {{ tarea.ncodeje }}
        </td>
        <td>
          {{ tarea.sdeseje }}
        </td>
        <td>
          {{ tarea.sacceje }}
        </td>
        <td>
          <button class="btn btn-outline-dark" (click)="duplicarTarea(tarea)" ngbTooltip="Duplicar">
            <i class="bi bi-files"></i>
          </button>
        </td>
        <td>
          <button class="btn btn-outline-dark" (click)="openEditTaskModal(tarea, editTaskModal)" ngbTooltip="Editar">
            <i class="bi bi-pencil"></i>
          </button>
        </td>
        <td>
          <button class="btn btn-outline-dark" (click)="eliminarTarea(tarea.idtarea)" ngbTooltip="Eliminar">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-----------------------------------------------
  --------------- ADD TASK MODAL ----------------
  ----------------------------------------------->
<ng-template #newTaskModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Informar lo que hice hoy</h4>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
      (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="frmNewTask" autocomplete="off">
      <div class="row mb-3">
        <div class="col">
          <label for="tipoCliente" class="form-label">Cliente</label>
          <select class="form-select" formControlName="ntipocliente">
            <option value="nc">No corresponde</option>
            <option value="nuevo">Nuevo</option>
            <option value="antiguo">Antiguo</option>
            <option value="varios">Varios</option>
          </select>
        </div>
        <div class="col">
          <label for="tipoAtencion" class="form-label">Atención</label>
          <select class="form-select" formControlName="ntipoatencion">
            <option value="nc">No corresponde</option>
            <option value="por-expediente">Por expediente</option>
            <option value="presencial">Presencial</option>
            <option value="via-celular">Vía celular</option>
            <option value="via-internet">Vía internet</option>
          </select>
        </div>
        <div class="col">
          <label for="nexpediente" class="form-label">Expediente</label>
          <div class="input-group mb-3">
            <input type="text" class="form-control" id="nexpediente" formControlName="sexpediente"
              aria-describedby="exp-addon1" />
            <div class="input-group-append">
              <button (click)="buscarExpedienteAlias()" class="input-group-text" id="exp-addon1">
                <i class="bi bi-search" *ngIf="!lSearching"></i>
                <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"
                  *ngIf="lSearching"></span>
              </button>
            </div>
          </div>
        </div>
        <div class="col">
          <label for="especialidad" class="form-label">Tipo de proceso</label>
          <select class="form-select" id="especialidad" formControlName="ntipoproceso" (change)="setLstIterNewTask()">
            <option value="nc">No corresponde</option>
            <option value="laboral">Laboral</option>
            <option value="penal">Penal</option>
            <option value="civil">Civil</option>
            <option value="familia">Familia</option>
            <option value="constitucional">Constitucional</option>
            <option value="tramite-adm">Trámite Adm.</option>
            <option value="tramite-not">Trámite Notarial</option>
            <option value="varios">Varios</option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="nombreCliente" class="form-label">
            Demandante
          </label>
          <input type="text" class="form-control" id="nombreCliente" formControlName="scliente" />
        </div>
        <div class="col">
          <label for="nombreDemandado" class="form-label">
            Demandado
          </label>
          <input type="text" class="form-control" id="nombreDemandado" formControlName="sdemandado" />
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="iteractividad" class="form-label"> ITER Procesal </label>
          <select class="form-select" id="iteractividad" formControlName="niter">
            <option *ngFor="let iter of lstIter" [value]="iter.id" [disabled]="!iter.pick">
              {{iter.desc}}
            </option>
          </select>
        </div>
        <div class="col">
          <label for="delegadoPor" class="form-label"> Delegado por </label>
          <select class="form-select" id="delegadoPor" formControlName="sdelegadopor">
            <option value="dra-lizbet">Dra. Lizbet</option>
            <option value="dra-erica">Dra. Erica</option>
            <option value="dr-alvaro">Dr. Alvaro</option>
            <option value="dra-estrella">Dra. Estrella</option>
            <option value="dr-huander">Dr. Huander</option>
            <option value="ing-wilber">Ing. Wilber</option>
            <option value="proactividad">Iniciativa Propia</option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="codigoEjecutivo" class="form-label"> Código </label>
          <select class="form-select" id="codigoEjecutivo" formControlName="ncodeje">
            <option *ngFor="let dil of lstDiligencias" [value]="dil.id" [disabled]="!dil.pick">
              {{dil.desc}}
            </option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="descripcionEjecutiva" class="form-label">
            Mención del caso, tarea, trabajo
          </label>
          <textarea class="form-control" id="descripcionEjecutiva" formControlName="sdeseje">
          </textarea>
        </div>
        <div class="col">
          <label for="accionesEjecutivas" class="form-label">
            Acciones a Realizar
          </label>
          <textarea class="form-control" id="accionesEjecutivas" formControlName="sacceje">
          </textarea>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="cumplimiento" class="form-label"> Cumplimiento(%) </label>
          <select class="form-select" id="cumplimiento" formControlName="navance">
            <option value="nc">No corresponde</option>
            <option value="10%">10%</option>
            <option value="20%">20%</option>
            <option value="30%">30%</option>
            <option value="40%">40%</option>
            <option value="50%">50%</option>
            <option value="60%">60%</option>
            <option value="70%">70%</option>
            <option value="80%">80%</option>
            <option value="90%">90%</option>
            <option value="100%">100%</option>
          </select>
        </div>
        <div class="col">
          <label for="tiempoAtencion" class="form-label">
            Tiempo de Atención
          </label>
          <br />
          <div style="display: flex;">
            <select class="form-control" style="display: inline-block;" id="tiempoAtencion"
              formControlName="nhorasatencion">
              <option value="00">0h</option>
              <option value="01">1h</option>
              <option value="02">2h</option>
              <option value="03">3h</option>
              <option value="04">4h</option>
              <option value="05">5h</option>
              <option value="06">6h</option>
              <option value="07">7h</option>
              <option value="08">8h</option>
              <option value="09">9h</option>
              <option value="10">10h</option>
              <option value="11">11h</option>
              <option value="12">12h</option>
            </select>
            <select class="form-control" style="display: inline-block;" formControlName="nminutosatencion">
              <option value="00">00m</option>
              <option value="05">05m</option>
              <option value="10">10m</option>
              <option value="15">15m</option>
              <option value="20">20m</option>
              <option value="25">25m</option>
              <option value="30">30m</option>
              <option value="35">35m</option>
              <option value="40">40m</option>
              <option value="45">45m</option>
              <option value="50">50m</option>
              <option value="55">55m</option>
            </select>
          </div>

        </div>
        <div class="col">
          <label for="fechaCulminacion" class="form-label">
            Fecha culminación
          </label>
          <input type="text" class="form-control" id="fechaCulminacion" formControlName="fculminacion" />
          <!-- <div class="input-group">
            <input
              id="fechaCulminacion"
              class="form-control"
              placeholder="yyyy-mm-dd"
              ngbDatepicker
              #dp="ngbDatepicker"
              formControlName="fculminacion"
            />
            <button
              type="button"
              class="btn btn-outline-secondary bi bi-calendar"
              (click)="dp.toggle()"
            ></button>
          </div> -->
        </div>
        <div class="col">

        </div>
      </div>
    </form>
    <div *ngIf="frmNewTask.invalid" class="alert alert-warning">
      Complete todos los campos
    </div>
    <div *ngIf="!frmNewTask.invalid" class="alert alert-success">
      Formulario válido
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="agregarTarea()"
      [disabled]="!(frmNewTask.valid && !lCreating)">
      <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" *ngIf="lCreating">
      </span>
      <span class="sr-only" *ngIf="!lCreating">
        Guardar
      </span>
      <span class="sr-only" *ngIf="lCreating">
        Guardando...
      </span>
    </button>
  </div>
</ng-template>

<!-----------------------------------------------
  ------------- EDIT TASK MODAL -----------------
  ----------------------------------------------->
<ng-template #editTaskModal let-modal>
  <div class="modal-header">
    <h4 class="modal-title" id="modal-basic-title">Editar Tarea</h4>
    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
      (click)="modal.dismiss('Cross click')"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="frmEditTask" autocomplete="off">
      <div class="row mb-3">
        <div class="col">
          <label for="tipoCliente" class="form-label">Cliente</label>
          <select class="form-select" formControlName="ntipocliente">
            <option value="nc">No corresponde</option>
            <option value="nuevo">Nuevo</option>
            <option value="antiguo">Antiguo</option>
            <option value="varios">Varios</option>
          </select>
        </div>
        <div class="col">
          <label for="tipoAtencion" class="form-label">Atención</label>
          <select class="form-select" formControlName="ntipoatencion">
            <option value="nc">No corresponde</option>
            <option value="por-expediente">Por expediente</option>
            <option value="presencial">Presencial</option>
            <option value="via-celular">Vía celular</option>
            <option value="via-internet">Vía internet</option>
          </select>
        </div>
        <div class="col">
          <label for="nexpediente" class="form-label">Expediente</label>
          <input type="text" class="form-control" id="nexpediente" formControlName="sexpediente" />
        </div>
        <div class="col">
          <label for="especialidad" class="form-label">Tipo de proceso</label>
          <select class="form-select" id="especialidad" formControlName="ntipoproceso" (change)="setLstIterEditTask()">
            <option value="nc">No corresponde</option>
            <option value="laboral">Laboral</option>
            <option value="penal">Penal</option>
            <option value="civil">Civil</option>
            <option value="familia">Familia</option>
            <option value="constitucional">Constitucional</option>
            <option value="tramite-adm">Trámite Adm.</option>
            <option value="tramite-not">Trámite Notarial</option>
            <option value="varios">Varios</option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="nombreCliente" class="form-label">
            Demandante
          </label>
          <input type="text" class="form-control" id="nombreCliente" formControlName="scliente" />
        </div>
        <div class="col">
          <label for="nombreDemandado" class="form-label">
            Demandado
          </label>
          <input type="text" class="form-control" id="nombreDemandado" formControlName="sdemandado" />
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="iteractividad" class="form-label"> ITER Procesal </label>
          <select class="form-select" id="iteractividad" formControlName="niter">
            <option *ngFor="let iter of lstIter" [value]="iter.id" [disabled]="!iter.pick">
              {{iter.desc}}
            </option>
          </select>
        </div>
        <div class="col">
          <label for="delegadoPor" class="form-label"> Delegado por </label>
          <select class="form-select" id="delegadoPor" formControlName="sdelegadopor">
            <option value="dra-lizbet">Dra. Lizbet</option>
            <option value="dra-erica">Dra. Erica</option>
            <option value="dr-alvaro">Dr. Alvaro</option>
            <option value="dra-estrella">Dra. Estrella</option>
            <option value="dr-huander">Dr. Huander</option>
            <option value="ing-wilber">Ing. Wilber</option>
            <option value="proactividad">Iniciativa Propia</option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="codigoEjecutivo" class="form-label"> Código </label>
          <select class="form-select" id="codigoEjecutivo" formControlName="ncodeje">
            <option *ngFor="let dil of lstDiligencias" [value]="dil.id" [disabled]="!dil.pick">
              {{dil.desc}}
            </option>
          </select>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="descripcionEjecutiva" class="form-label">
            Mención del caso, tarea, trabajo
          </label>
          <textarea class="form-control" id="descripcionEjecutiva" formControlName="sdeseje">
          </textarea>
        </div>
        <div class="col">
          <label for="accionesEjecutivas" class="form-label">
            Acciones a Realizar
          </label>
          <textarea class="form-control" id="accionesEjecutivas" formControlName="sacceje">
          </textarea>
        </div>
      </div>

      <div class="row mb-3">
        <div class="col">
          <label for="cumplimiento" class="form-label"> Cumplimiento(%) </label>
          <select class="form-select" id="cumplimiento" formControlName="navance">
            <option value="nc">No corresponde</option>
            <option value="10%">10%</option>
            <option value="20%">20%</option>
            <option value="30%">30%</option>
            <option value="40%">40%</option>
            <option value="50%">50%</option>
            <option value="60%">60%</option>
            <option value="70%">70%</option>
            <option value="80%">80%</option>
            <option value="90%">90%</option>
            <option value="100%">100%</option>
          </select>
        </div>
        <div class="col">
          <label for="tiempoAtencion" class="form-label">
            Tiempo de Atención
          </label>
          <br />
          <div style="display: flex;">
            <select class="form-control" style="display: inline-block;" id="tiempoAtencion"
              formControlName="nhorasatencion">
              <option value="00">0h</option>
              <option value="01">1h</option>
              <option value="02">2h</option>
              <option value="03">3h</option>
              <option value="04">4h</option>
              <option value="05">5h</option>
              <option value="06">6h</option>
              <option value="07">7h</option>
              <option value="08">8h</option>
              <option value="09">9h</option>
              <option value="10">10h</option>
              <option value="11">11h</option>
              <option value="12">12h</option>
            </select>
            <select class="form-control" style="display: inline-block;" formControlName="nminutosatencion">
              <option value="00">00m</option>
              <option value="05">05m</option>
              <option value="10">10m</option>
              <option value="15">15m</option>
              <option value="20">20m</option>
              <option value="25">25m</option>
              <option value="30">30m</option>
              <option value="35">35m</option>
              <option value="40">40m</option>
              <option value="45">45m</option>
              <option value="50">50m</option>
              <option value="55">55m</option>
            </select>
          </div>

        </div>
        <div class="col">
          <label for="fechaCulminacion" class="form-label">
            Fecha culminación
          </label>
          <input type="text" class="form-control" id="fechaCulminacion" formControlName="fculminacion" />
          <!-- <div class="input-group">
            <input
              id="fechaCulminacion"
              class="form-control"
              placeholder="yyyy-mm-dd"
              ngbDatepicker
              #dp="ngbDatepicker"
              formControlName="fculminacion"
            />
            <button
              type="button"
              class="btn btn-outline-secondary bi bi-calendar"
              (click)="dp.toggle()"
            ></button>
          </div> -->
        </div>
        <div class="col">

        </div>
      </div>
    </form>
    <div *ngIf="frmEditTask.invalid" class="alert alert-warning">
      Complete todos los campos
    </div>
    <div *ngIf="!frmEditTask.invalid" class="alert alert-success">
      Formulario válido
    </div>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-primary" (click)="editarTarea()"
      [disabled]="!(frmEditTask.valid && !lUpdating)">
      <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true" *ngIf="lUpdating">
      </span>
      <span class="sr-only" *ngIf="!lUpdating">
        Actualizar tarea
      </span>
      <span class="sr-only" *ngIf="lUpdating">
        Actualizando...
      </span>
    </button>
  </div>
</ng-template>